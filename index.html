<!DOCTYPE html>
<html>
<head>
    <title>Bug Bounty Scanner</title>
    <script>
        function startScan() {
            let targetUrl = document.getElementById("targetUrl").value;
            if (!targetUrl) {
                alert("Please enter a valid URL");
                return;
            }

            fetch(`http://127.0.0.1:5000/scan?url=${encodeURIComponent(targetUrl)}`)
                .then(response => response.json())
                .then(data => alert(data.message))
                .catch(error => alert("Error: " + error));
        }

        function getResults() {
            fetch('http://127.0.0.1:5000/results')
                .then(response => response.json())
                .then(data => displayResults(data))
                .catch(error => alert("Error: " + error));
        }

        function displayResults(data) {
            let resultDiv = document.getElementById("results");
            resultDiv.innerHTML = "<h3>Scan Results</h3>";
            let list = document.createElement("ul");
            list.style.maxHeight = "300px";
            list.style.overflowY = "auto";
            list.style.border = "1px solid black";
            list.style.padding = "10px";
            list.style.listStyleType = "none";

            // Sort by risk first, then by confidence
            const riskLevels = { "High": 3, "Medium": 2, "Low": 1 };
            const confidenceLevels = { "High": 3, "Medium": 2, "Low": 1 };
            data.sort((a, b) => 
                (riskLevels[b.risk] - riskLevels[a.risk]) || 
                (confidenceLevels[b.confidence] - confidenceLevels[a.confidence])
            );

            data.forEach((alert, index) => {
                let listItem = document.createElement("li");
                listItem.innerHTML = `<strong>${alert.alert}</strong> - <span style="color:${alert.risk === 'High' ? 'red' : alert.risk === 'Medium' ? 'orange' : 'green'}">${alert.risk}</span>`;
                listItem.style.cursor = "pointer";
                listItem.style.padding = "5px";
                listItem.style.borderBottom = "1px solid #ccc";

                // Show alert details on click
                listItem.onclick = function() {
                    document.getElementById("alertDetails").innerHTML = `
                        <h3>${alert.alert}</h3>
                        <p><strong>Risk:</strong> ${alert.risk}</p>
                        <p><strong>Confidence:</strong> ${alert.confidence}</p>
                        <p><strong>Description:</strong> ${alert.description}</p>
                        <p><strong>Solution:</strong> ${alert.solution}</p>
                        <p><strong>Reference:</strong> <a href="${alert.reference}" target="_blank">${alert.reference}</a></p>
                    `;
                };

                list.appendChild(listItem);
            });

            resultDiv.appendChild(list);
        }
    </script>
</head>
<body>
    <h1>Bug Bounty Scanner</h1>
    <label for="targetUrl">Enter Target URL:</label>
    <input type="text" id="targetUrl" placeholder="https://example.com">
    <button onclick="startScan()">Start Scan</button>
    <button onclick="getResults()">View Results</button>

    <div id="results"></div>

    <div id="alertDetails" style="margin-top:20px; border:1px solid black; padding:10px;"></div>
</body>
</html>
